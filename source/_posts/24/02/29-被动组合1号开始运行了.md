---
title: è¢«åŠ¨ç»„åˆ1å·å¼€å§‹è¿è¡Œäº†
date: 2024-02-29 11:24:53
categories:
tags:
    - python
    - ç®—æ³•
    - github
---


åœ¨ [æ„å»ºè¢«åŠ¨æ”¶å…¥ç»„åˆ](https://mp.weixin.qq.com/s?__biz=MzA3NzMyNTIyOA==&mid=2651482396&idx=1&sn=8163e29883b23fc89ba3d78f84190e44&chksm=84ad7fdfb3daf6c9a6a18598453f8c17f714966a846bbea799fce8080b4da1566c84bbf6e3b3#rd) ä¸€æ–‡ä¸­æè¿°äº†ä¸€ä¸ªæ„å»ºè¢«åŠ¨æŠ•èµ„ç»„åˆçš„æƒ³æ³•ï¼Œç”¨æ¥è¿½è¸ªAè‚¡æŒ‡æ•°ã€‚ç›®å‰ï¼Œè¿™ä¸ªç»„åˆå·²ç»å¼€å§‹è¿è¡Œäº†ã€‚

é¡¹ç›®åœ°å€ï¼š[GitHub](https://github.com/pengwon/my-investment)

> ğŸ’¡æ³¨æ„ï¼šè¯¥é¡¹ç›®ä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ï¼Œä»…ç”¨äºæŠ€æœ¯äº¤æµã€‚

## 1å·ç»„åˆ

1å·ç»„åˆæ˜¯ä¸€ä¸ªè¢«åŠ¨ç»„åˆï¼Œä¸»è¦å…³æ³¨æ²ªæ·±300ã€ä¸­è¯500ã€ç§‘åˆ›50ã€åŒ—è¯50ã€MSCIä¸­å›½A50æŒ‡æ•°ã€‚

å› ä¸ºè¿˜æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„åˆ¸å•†äº¤æ˜“APIï¼Œä¸ºä¾¿äºæ“ä½œå’Œè®¡ç®—ï¼Œé€‰å–äº†å¯¹åº”çš„åœºå¤–ETFè”æ¥åŸºé‡‘ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡åœ¨æ”¯ä»˜å®ä¸­è®¾ç½®å®šæŠ•å®ç°ä¹°å…¥æ“ä½œï¼Œåˆ†åˆ«æ˜¯ï¼š

- æ²ªæ·±300ï¼šæ˜“æ–¹è¾¾æ²ªæ·±300ETFè”æ¥C(007339)
- ä¸­è¯500ï¼šæ˜“æ–¹è¾¾ä¸­è¯500ETFè”æ¥C(007029)
- ç§‘åˆ›50ï¼šæ˜“æ–¹è¾¾ä¸Šè¯ç§‘åˆ›50è”æ¥C(011609)
- åŒ—è¯50ï¼šæ˜“æ–¹è¾¾åŒ—è¯50æˆä»½æŒ‡æ•°C(017516)
- MSCIä¸­å›½A50ï¼šæ˜“æ–¹è¾¾MSCIä¸­å›½A50äº’è”äº’é€šETFè”æ¥C(014533)

<!-- more -->

### äº¤æ˜“ç­–ç•¥

ä¸ºæ–¹ä¾¿è®¡ç®—ï¼Œå‡è®¾æœ¬é‡‘10ä¸‡å…ƒï¼Œ5ä¸ªæŒ‡æ•°å‡ç­‰åˆ†é…ï¼Œæ¯ä¸ªæŒ‡æ•°2ä¸‡å…ƒã€‚å†å°†æ¯ä¸ªæŒ‡æ•°çš„2ä¸‡å…ƒåˆ†æˆ100ä»½è¿›è¡Œå®šæŠ•ã€‚

#### ä¹°å…¥

1. æ²ªæ·±300å’ŒMSCIä¸­å›½A50æ¯å‘¨äºŒã€å››å®šæŠ•2æ¬¡ï¼Œé‡‡ç”¨æ¶¨è·Œå¹…ç­–ç•¥ã€‚
2. ä¸­è¯500ã€ç§‘åˆ›50å’ŒåŒ—è¯50æ¯å‘¨äºŒã€ä¸‰ã€å››å®šæŠ•3æ¬¡ï¼Œé‡‡ç”¨æ¶¨è·Œå¹…ç­–ç•¥ã€‚

#### å–å‡º

æ¯ä¸ªäº¤æ˜“æ—¥æ£€æŸ¥åŸºé‡‘å‡€å€¼ï¼š

1. å½“æŠ•å…¥ä»½é¢å°äº25%æ—¶ï¼ŒæŒæœ‰æ”¶ç›Šå¤§äº8%ï¼Œåˆ™å…¨éƒ¨å–å‡ºã€‚
2. å½“æŠ•å…¥ä»½é¢å°äº50%æ—¶ï¼ŒæŒæœ‰æ”¶ç›Šå¤§äº10%ï¼Œåˆ™å…¨éƒ¨å–å‡ºã€‚
3. å½“æŠ•å…¥ä»½é¢å°äº75%æ—¶ï¼ŒæŒæœ‰æ”¶ç›Šå¤§äº12%ï¼Œåˆ™å…¨éƒ¨å–å‡ºã€‚
4. å½“æŠ•å…¥ä»½é¢å¤§äº75%æ—¶ï¼ŒæŒæœ‰æ”¶ç›Šå¤§äº15%ï¼Œåˆ™å…¨éƒ¨å–å‡ºã€‚

### æ•°æ®æº

1. [ä¸­è¯æŒ‡æ•°](https://www.csindex.com.cn/#/indices/family/detail?indexCode=000300)
2. [è›‹å·åŸºé‡‘](https://danjuanfunds.com/djmodule/value-center?channel=1300100141)
3. [é›ªçƒåŸºé‡‘](https://danjuanfunds.com/funding/011609?channel=XQWEB0001)
4. [ä¸œæ–¹è´¢å¯Œ](https://quote.eastmoney.com/sh560050.html)
5. [åŒèŠ±é¡º](https://fund.10jqka.com.cn/011609/)

ä¸­è¯æŒ‡æ•°æœ€è¿‘åˆæ¨å‡ºäº†ä¸­è¯A50æŒ‡æ•°ï¼Œä¸­è¯A50æŒ‡æ•°ä»å„è¡Œä¸šé¾™å¤´ä¸Šå¸‚å…¬å¸è¯åˆ¸ä¸­ï¼Œé€‰å–å¸‚å€¼æœ€å¤§çš„50åªè¯åˆ¸ä½œä¸ºæŒ‡æ•°æ ·æœ¬ï¼Œä»¥åæ˜ å„è¡Œä¸šæœ€å…·ä»£è¡¨æ€§çš„é¾™å¤´ä¸Šå¸‚å…¬å¸è¯åˆ¸çš„æ•´ä½“è¡¨ç°ã€‚ç»„åˆä¸­æœªæ¥å¯èƒ½ä¼šç”¨ä¸­è¯A50æŒ‡æ•°æ›¿ä»£MSCIä¸­å›½A50ã€‚

#### æŒ‡æ•°æ•°æ®

ä¸­è¯æŒ‡æ•°å®˜ç½‘æœ¬æ˜¯æœ€ç†æƒ³çš„æ•°æ®æºï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®æ—¶å¯ä»¥å‘ç°æ•°æ®æ˜¯åŠ¨æ€åŠ è½½çš„ï¼Œå¹¶ä¸”è¿”å›æ•°æ®æ˜¯æ ‡å‡†jsonæ ¼å¼ï¼š

![ä¸­è¯æŒ‡æ•°å®˜ç½‘](https://imgs.boringhex.top/blog/20240229152536.png)

ä½†å®é™…ä½¿ç”¨pythonè·å–æ•°æ®æ—¶ï¼Œå‘ç°è¿”å›çš„æ˜¯ä¸€ä¸ªéªŒè¯é¡µé¢ï¼Œæ— æ³•ç›´æ¥è·å–æ•°æ®ã€‚æ•°æ®è¦ç´ è¶Šæ¥è¶Šé‡è¦ï¼Œå¯¹æ•°æ®çš„ä¿æŠ¤ä¹Ÿè¶Šæ¥è¶Šä¸¥æ ¼ï¼Œè¿™æ˜¯ä¸€ä¸ªè¶‹åŠ¿ã€‚æ¯•ç«Ÿæ•°æ®æ¥å£æ˜¯ä¸€é¡¹æ”¶è´¹æœåŠ¡ï¼Œå¦‚æœè¢«è½»æ˜“ç»•è¿‡å°±ä¸å¤ªå¯¹äº†ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æƒ³èµ·æ¥ä¹‹å‰å…³æ³¨çš„ä¸€ä¸ªé¡¹ç›®ï¼š[tushare](https://tushare.pro/)ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…è´¹çš„é‡‘èæ•°æ®æ¥å£ï¼Œæä¾›äº†ä¸°å¯Œçš„æ•°æ®æ¥å£ï¼ŒåŒ…æ‹¬è‚¡ç¥¨ã€åŸºé‡‘ã€æŒ‡æ•°ç­‰ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ•°æ®æºï¼Œå¯ä»¥ç”¨æ¥è·å–æŒ‡æ•°æ•°æ®ã€‚ä½†æ˜¯éšç€æ•°æ®çš„å¢åŠ ï¼Œtushareçš„æ•°æ®æ¥å£ä¹Ÿè¶Šæ¥è¶Šå—åˆ°é™åˆ¶ï¼Œéœ€è¦ä»˜è´¹æ‰èƒ½ä½¿ç”¨æ›´å¤šçš„æ•°æ®ã€‚

#### åŸºé‡‘æ•°æ®

å®é™…ä¸Šï¼Œè¢«åŠ¨ç»„åˆæ˜¯ä¸€ä¸ªé•¿æœŸç­–ç•¥ï¼Œä¸éœ€è¦è·å–é«˜é¢‘æ•°æ®ï¼Œåªéœ€è¦è·å–æ¯æ—¥çš„å‡€å€¼æ•°æ®å³å¯ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨å…è´¹çš„æ•°æ®æ¥å£äº†ï¼Œæ¯”å¦‚é›ªçƒåŸºé‡‘ã€ä¸œæ–¹è´¢å¯Œã€åŒèŠ±é¡ºç­‰ï¼Œè¿™äº›ç½‘ç«™éƒ½æä¾›äº†å…è´¹çš„åŸºé‡‘å‡€å€¼æ•°æ®ã€‚æ•°æ®æ›´æ–°æ…¢ä¸€ç‚¹ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚æœ€åç”¨ä¸œè´¢çš„é™æ€é¡µé¢è·å–åŸºé‡‘å‡€å€¼æ•°æ®ã€‚

å…³é”®ä»£ç ï¼š

```python
def update_fund_data(fund_code: str, date: str, max_retries: int = 5):
    url = f"https://fund.eastmoney.com/{fund_code}.html"
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0"
    }

    session = requests.Session()
    for _ in range(max_retries):
        try:
            response = session.get(url, headers=headers)
            response.raise_for_status()
            break
        except requests.exceptions.RequestException as e:
            print(f"Request failed: {e}. Retrying...")
    else:
        print("Max retries exceeded")
        return None

    soup = BeautifulSoup(response.text, "html.parser")
    data_item_02 = soup.find("dl", {"class": "dataItem02"})
    if data_item_02 is None:
        print("Failed to find data item.")
        return None

    data_date = data_item_02.find("dt").text.split(" ")[-1].strip("()")
    unit_value = data_item_02.find(
        "span", {"class": re.compile(r"ui-font-large ui-color-(red|green) ui-num")}
    ).text
    growth_rate = data_item_02.find_all(
        "span", {"class": re.compile(r"ui-font-middle ui-color-(red|green) ui-num")}
    )[0].text

    if data_date != date:
        print(
            f"The date of the fund {fund_code} data is {data_date}, current is {date}."
        )
        print(f"Failed to update data for {fund_code} {url}.")
        return None

    new_data = {"date": date, "unit_value": unit_value, "growth_rate": growth_rate}
    file_path = f"../data/{fund_code}.json"
    with open(file_path, "r+", encoding="utf-8") as f:
        try:
            fund_data = json.load(f)
        except json.JSONDecodeError:
            print("Failed to decode JSON data.")
            return None

        for item in fund_data["market_data"]:
            if item["date"] == date:
                item.update(new_data)
                break
        else:
            fund_data["market_data"].append(new_data)

        f.seek(0)
        json.dump(fund_data, f, indent=4)
        f.truncate()

    print(f"Data for {fund_code} on {date} has been updated.")
    return new_data
 ```

 æœ€è¿‘å‡ å¤©æ›´æ–°å‡ºæ¥çš„æ•°æ®ï¼š

 ```json
 {
    "name": "\u6613\u65b9\u8fbe\u4e2d\u8bc1500ETF\u8054\u63a5C",
    "code": "007029",
    "market_data": [
        {
            "date": "2024-02-20",
            "unit_value": "1.1865",
            "growth_rate": "-0.10%"
        },
        {
            "date": "2024-02-21",
            "unit_value": "1.1865",
            "growth_rate": "0.00%"
        },
        {
            "date": "2024-02-22",
            "unit_value": "1.1942",
            "growth_rate": "0.65%"
        },
        {
            "date": "2024-02-23",
            "unit_value": "1.1991",
            "growth_rate": "0.41%"
        },
        {
            "date": "2024-02-26",
            "unit_value": "1.1985",
            "growth_rate": "-0.05%"
        },
        {
            "date": "2024-02-27",
            "unit_value": "1.2231",
            "growth_rate": "2.05%"
        }
    ]
}
```

æˆ‘åœ¨ä»“åº“ä¸­è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ›´æ–°ä¸€æ¬¡æ•°æ®ã€‚åé¢æœ‰æ—¶é—´å†ç»™åšå®¢å¢åŠ ä¸€ä¸ªé¡µé¢ï¼ŒæŠŠè¿™ä¸ªç»„åˆæ•°æ®å¯è§†åŒ–å‡ºæ¥ã€‚
